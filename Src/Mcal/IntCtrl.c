/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        File :  IntCrtl.c
*        brief :  Nested Vector Interrupt Controller Driver
 *
 *      Details:  The Driver Configure All MCU interrupts Priority into gorups and subgroups
 *                Enable NVIC Interrupt Gate for Peripherals
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/

#include "IntCtrl.h"


/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/	

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/
	
/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/


void IntCrtl_Init(void)
{
	
	// Configuring the split of group priority from subpriority in APINT REG
	SCB_APINT.R=(APINT_REG_KEY|(Int_xGroupPriority_xSub<<8));
	
	
	// Enable all interrupts defined by the user and sit there priority in PRIx Reg for each interrupt
	for(uint8 i=0;i<Num_OfInt_TO_ENABLE;i++	)
	{
		uint8 int_number= interrupt_config[i].Int_Num;
		
		//Assign Group\Subgroup priority in NVIC_PRIx Nvic
		uint8 Priority_INTx=int_number%4;
		switch(Priority_INTx)
		{
			case 0:
				NVIC_REGS.PRIx[int_number/4].B.INTA=interrupt_config[i].Priority;
				break;
			case 1:
				NVIC_REGS.PRIx[int_number/4].B.INTB=interrupt_config[i].Priority;
				break;
			case 2:
				NVIC_REGS.PRIx[int_number/4].B.INTC=interrupt_config[i].Priority;
				break;
			case 3:
				NVIC_REGS.PRIx[int_number/4].B.INTD=interrupt_config[i].Priority;
				break;
		}
		
		//Enable the Interrupt bit in ENx Register
		SIT_BIT( NVIC_REGS.ENx[int_number/32].R,int_number%32 );
	}
	

	/*TODO : Enable\Disable based on user configurations in NVIC_ENx and SCB_Sys Registers */
	
}




/**********************************************************************************************************************
 *  END OF FILE: IntCrtl.c
 *********************************************************************************************************************/
